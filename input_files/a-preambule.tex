%!TEX root = ../main.tex

%% ==============================================================
%% Encoding

\usepackage[french]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

%% ==============================================================
%% Title page style

%% INPT / Toulouse University title page
\usepackage[ED=MITT-SIAO, Ets=INP]{tlsflyleaf}

% \usepackage{lmodern}\normalfont
% \DeclareFontShape{T1}{lmr}{bx}{sc}{ <-> ssub * cmr/bx/sc }{}
% \DeclareOldFontCommand{\bf}{\normalfont\bfseries}{\mathbf}
% \usepackage[osf,sc]{mathpazo}

%% Setup basic string
\title{Acquisition rapide et reconstruction en imagerie EELS.}
%
\author{Etienne Monier}
%
\defencedate{??/??/????}
%
\lab{Institut de Recherche en Informatique de Toulouse (UMR 5505)}

%% Boss
\nboss{2}
%
\makesomeone{boss}{1}{Nicolas \textsc{Dobigeon}}{Professeur à l'INP-ENSEEIHT}{Directeur de thèse}
\makesomeone{boss}{2}{Thomas \textsc{Oberlin}}{Maître de conférence à l'INP-ENSEEIHT}{Co-directeur de thèse}

%% Referee
\nreferee{2}
\makesomeone{referee}{1}{? \textsc{?}}{?}{Rapporteur}
\makesomeone{referee}{2}{? \textsc{?}}{?}{Rapporteur}

%% Judges
\njudge{7}
\makesomeone{judge}{1}{? \textsc{?}}{?}{Rapporteur}
\makesomeone{judge}{2}{? \textsc{?}}{?}{Rapporteur}
\makesomeone{judge}{3}{? \textsc{?}}{?}{Examinateur}
\makesomeone{judge}{4}{? \textsc{?}}{?}{Examinateur}
\makesomeone{judge}{5}{? \textsc{?}}{?}{Examinateur}
\makesomeone{judge}{6}{Nicolas \textsc{Dobigeon}}{Professeur à l'INP-ENSEEIHT}{Directeur de thèse}
\makesomeone{judge}{7}{Thomas \textsc{Oberlin}}{Maître de conférence à l'ISAE-SUPAERO}{Co-directeur de thèse}


%% ==============================================================
%% Warning filtering

\usepackage{silence}
%\WarningFilter{biblatex}{Patching footnotes failed}
%\WarningFilter{biblatex}{Attempt to redefine deprecated}
\WarningFilter{latex}{Marginpar on page}
\WarningFilter{latexfont}{Font shape}
\WarningFilter{latexfont}{Some font}
\WarningFilter{latexfont}{Size substitutions}

%% ==============================================================
%% Index

% Generates the index https://en.wikibooks.org/wiki/LaTeX/Indexing
% https://www.overleaf.com/learn/latex/Indices
% To make clickable links with hyperref
% pass nohyper option to tufte documentclass
% and load hyperref after imakeidx
\usepackage{imakeidx}
\indexsetup{level=\chapter*, toclevel=chapter}
\makeindex[title=Index, columns=1, intoc]

%% ==============================================================
%% Hyperef links

\usepackage[svgnames]{xcolor}
\definecolor{mydarkblue}{rgb}{0,0.08,0.45}
\definecolor{myblue}{RGB}{18,75,126}
\definecolor{burgundy}{RGB}{128,0,32}

\usepackage{hyperref}
\hypersetup{
    linktoc=all,
    breaklinks=true,
    colorlinks=true,
    linkcolor=mydarkblue,
    citecolor=mydarkblue,
    filecolor=mydarkblue,
    urlcolor=mydarkblue
}


%% ==============================================================
%% Glossary

% https://www.overleaf.com/learn/latex/Glossaries
% Terminal: makeglossaries main
% rebuild main.tex
% To make clickable links with hyperref
% load hyperref before glossaries

% Some lengths
\TufteRecalculate
\newlength\fullwidthwidth
\makeatletter\setlength\fullwidthwidth{\@tufte@fullwidth}\makeatother

\newlength\centralcol
\setlength\centralcol{\fullwidthwidth}
\addtolength{\centralcol}{-5cm}

% Glossaries input.
\usepackage[%
    % nopostdot,  % If no final point is desired for description.
    nonumberlist,  % The location should not be displayed.
    acronym,
    toc,
    section=subsection,  % Sets the printglossaries be a section.
    numberedsection=false,  % To have section* instead of section.
    nogroupskip=true,
    xindy,
    ucmark,
    shortcuts]{glossaries}

%
% New gloassaries
%

% Adds a key to glossaries entries
\glsaddstoragekey{shape}{}{\glsshape}

% Add all entries into list


% Glossaries sections
\newglossary[nglg]{notgen}{nge}{ngtn}{Notations générales}
\newglossary[nlg]{notation}{not}{ntn}{Notations}

%
% Format
%

% Defines the accronym display style. Long desc. first, then short one.
\setacronymstyle{long-short}

% Removes space after section name
\renewcommand{\glossarypreamble}{\vspace*{-\baselineskip}}

% This command disables hyperlinks from text to glossary list.
\glsdisablehyper

% https://tex.stackexchange.com/questions/269565/glossaries-how-to-customize-list-of-symbols-with-additional-column-for-units

%\setlength\centralcol{10cm minus 1.5cm minus 1.5cm}
\newglossarystyle{symbunitlong}{%
    \setglossarystyle{long3col}% base this style on the list style
    \renewenvironment{theglossary}{% Change the table type --> 3 columns
        \begin{longtable}{p{1.5cm}p{\centralcol}>{\hfill}p{1.5cm}}}%
        {\end{longtable}}%
    %
%    \renewcommand*{\glossaryheader}{%  Change the table header
%        \bfseries Sign & \bfseries Description & \bfseries Unit \\
%        \hline
%        \endhead}
    \renewcommand*{\glossentry}[2]{%  Change the displayed items
        \glstarget{##1}{\glossentryname{##1}} %
        & \glossentrydesc{##1}% Description
        & \glsshape{##1}  \tabularnewline
    }
}

\newglossarystyle{acrolong}{%
    \setglossarystyle{long3col}% base this style on the list style
    \renewenvironment{theglossary}{% Change the table type --> 3 columns
        \begin{longtable}{p{1.5cm}p{\textwidth-1.5cm}}}%
        {\end{longtable}}%
    %
    %    \renewcommand*{\glossaryheader}{%  Change the table header
    %        \bfseries Sign & \bfseries Description & \bfseries Unit \\
    %        \hline
    %        \endhead}
    \renewcommand*{\glossentry}[2]{%  Change the displayed items
        \glstarget{##1}{\glossentryname{##1}} %
        & \glossentrydesc{##1}% Description
        \tabularnewline
    }
}


%
% Starts glossaries and input entries
%

\makeglossaries

\input{input_files/acronyms_and_glossary}



%% ==============================================================
%% Nomenclature

% to build nomenclature
% makeindex main.nlo -s nomencl.ist -o main.nls
% rebuild main.tex
\usepackage[intoc]{nomencl}
\makenomenclature
% \nomlabelwidth=30mm
\setlength{\nomitemsep}{.5\parsep}
\renewcommand{\nomname}{Notations}
%\newcommand{\nomunit}[1]{%
%\renewcommand{\nomentryend}{\hspace*{\fill}#1}}

\usepackage{etoolbox}  % required in nomenclature.tex

%% ==============================================================
%% Subappendix

% Add appendix to each chapter
\usepackage[toc,page]{appendix}
\usepackage{chngcntr}

\AtBeginEnvironment{subappendices}{%
    \newpage
    \section*{Appendices}
    \phantomsection
    \addtocontents{toc}{\vspace{1ex}} % small vertical space
    \addtocontents{toc}{\protect\contentsline{section}{\protect\textsc{Appendices}}{}{}}
    \counterwithin{equation}{section}
    \counterwithin{figure}{section}
    \counterwithin{table}{section}
}
\AtEndEnvironment{subappendices}{%
    \counterwithin{equation}{section}
    \counterwithout{figure}{section}
    \counterwithout{table}{section}
}

%% ==============================================================
%% Style de page

\renewcommand\chaptermark[1]{\markboth{\chaptername\thechapter. #1}{}}
\renewcommand\sectionmark[1]{\markright{\thesection. #1}}

\usepackage[fit]{truncate}
\newcommand{\markformat}[1]{\truncate{0.95\textwidth}{\footnotesize\scshape\nouppercase{#1}}}

\renewcommand\frontmatter{%
    \cleardoublepage%
    \pagenumbering{roman}%
    %\pagestyle{plain}%
    \fancyhf{}%
    \ifthenelse{\boolean{@tufte@twoside}}%
    {\fancyhead[LE,RO]{\thepage}}%
    {\fancyhead[RE,RO]{\thepage}}%
}

\renewcommand\mainmatter{%
    \cleardoublepage%
    \pagenumbering{arabic}%
    \fancyhf{}%
%    \renewcommand{\chaptermark}[1]{\markboth{##1}{}}%
%    \fancyhead[LE]{\thepage\quad\smallcaps{\newlinetospace{\plaintitle}}}% book title
%    \fancyhead[RO]{\smallcaps{\newlinetospace{\leftmark}}\quad\thepage}% chapter title
\fancyhead[LO]{\markformat{\rightmark}}
\fancyhead[RE]{\markformat{\leftmark}}
\fancyhead[LE, RO]{\footnotesize\thepage}
}

\usepackage{fancyhdr}
% \pagestyle{fancy}

\RequirePackage{etoolbox}                                                   
\appto\frontmatter{\pagestyle{fancy}}                                       
\appto\mainmatter{\pagestyle{fancy}}                                        
\appto\backmatter{\pagestyle{empty}} 

% \fancyhf{}



%% ==============================================================
%% Text packages

\usepackage{xcolor}  % Colors
\usepackage{enumerate}
\usepackage[shortlabels]{enumitem}       % personnalisation des enumerate
\setlist[itemize]{label=$\square$}  % black

%% ==============================================================
%% Graphics packages

% Figure / Float
% \usepackage{float}      % Ability to define new figure style, proposes H as a position.
% \usepackage[caption=false]{subfig}     % Create subfloats with \subfloat[caption]{figure}
% or \subtable[caption]{figure}
% \usepackage{subfloat}
% \usepackage[export]{adjustbox}  % To use \vphantom for vertical alignment of subfloat.


% Include graphic
\usepackage{graphicx}
\DeclareGraphicsExtensions{.pdf,.jpg,.png}
\graphicspath{{img/}}

\usepackage[center]{subfigure}

% Tikz config
\usepackage{style/tikzstyle}

%% ==============================================================
%% Math packages

%% Math symbols and font
\usepackage{amsmath}    % Main commands.
\usepackage{amssymb}    % Main symbols
\usepackage{dsfont}     % \mathds{1} pour indicatrice
\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{mathrsfs}   % Ralph Smith’s Formal Script Font : mathscr{A}
\usepackage{mathtools}  % \DeclarePairedDelimiter{\ceil}{\lceil}{\rceil}
\usepackage{stmaryrd}   % \llbracket et \rrbracket %sinon : $[\![$ et $]\!]$

%% Algorithms
\usepackage[ruled,vlined]{algorithm2e} % package environnement algorithme

%% Theorems and definitions
\newtheorem{mydef}{Définition}

%\usepackage{tcolorbox}
%\tcbuselibrary{skins}
%\tcbuselibrary{theorems}
%
%\newtcbtheorem[number within=chapter]{definition}{Définition}{%
%colbacktitle=gray!40, colback=gray!20, boxrule=0pt, fonttitle=\bfseries,%
%arc=0pt,outer arc=0pt%
%}{definitionlabel}


%% ==============================================================
%% Tabular packages

\usepackage{tabularx}
\usepackage{multirow}
\usepackage{booktabs}     % For serious tables (\toprule, \midrule, \bottomrule).


%% ==============================================================
%% FontAwesome

\usepackage{pgffor}
\usepackage{fontawesome}

\newcommand{\minusfa}[1][1]{%
    \foreach \n in {1,...,#1}{\color{red}\faicon{minus-square}}%
}
\newcommand{\plusfa}[1][1]{%
    \foreach \n in {1,...,#1}{\color{green}\faicon{plus-square}}%  plus plus-square plus-circle
}
\newcommand{\checkfa}{{\color{black}\faicon{check-square}}}  % check check-square check-circle

%% ==============================================================
%% Pretty refs

\usepackage[noabbrev]{cleveref}


\usepackage[]{todo}
\renewcommand\todoformat{\bfseries\small\color{red}}

\newcommand{\mref}{{\bfseries\color{red}[REF]}}
% \usepackage{showframe}


%% ==============================================================
%% Correct label

%\let\oldlabel\label
%\renewcommand{\label}[1]{\protect\oldlabel{#1}}
%
%% margincaption, leftbody, ragged, wide
%\usepackage[rightcaption, ragged, margincaption]{sidecap}
%\sidecaptionvpos{figure}{t} 
%\sidecaptionvpos{table}{t}
%
%\usepackage{floatrow}
%\DeclareFloatSeparators{mcapwidth}{\begingroup\hspace{\marginparsep}\endgroup}
%\floatsetup[widefigure]{margins=hangright,capposition=beside,
%    capbesideposition={top,right},floatwidth=\textwidth, capbesidewidth=\marginparwidth}, capbesidesep=mcapwidth}
%


\usepackage{lipsum}
\usepackage{comment}

\usepackage{showframe}
